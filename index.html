<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebNote - Connexion</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0b0f1a;
            --surface: rgba(23, 28, 41, 0.8);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.12) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(30, 64, 175, 0.12) 0px, transparent 50%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
            overflow: hidden;
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 40px;
            background: var(--surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: cardAppear 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes cardAppear {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .logo-area {
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #4f46e5);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.8rem;
            box-shadow: 0 10px 20px var(--accent-glow);
        }

        h1 { font-size: 1.8rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 8px; }
        h1 span { color: var(--accent); }
        p { color: var(--text-dim); font-size: 0.9rem; margin-bottom: 30px; }

        .btn-google {
            width: 100%;
            padding: 14px;
            background: white;
            color: #1f2937;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-google:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255,255,255,0.1);
            background: #f9fafb;
        }

        .btn-google img { width: 20px; }

        .footer-text {
            margin-top: 25px;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* Effet de chargement */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="login-card">
        <div class="logo-area">
            <div class="logo-icon">
                <i class="fas fa-feather-pointed"></i>
            </div>
            <h1>WebNote<span>.</span></h1>
            <p>Connectez-vous pour accéder à votre dashboard et vos notes cloud.</p>
        </div>

        <button id="googleBtn" class="btn-google">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/button/google/small/btn_google_light_normal_ios.svg" alt="Google">
            Continuer avec Google
            <div class="loading-spinner" id="spinner"></div>
        </button>

        <div class="footer-text">
            <i class="fas fa-shield-halved"></i> Connexion sécurisée via Firebase
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyApC4T-WdDIFk3VuBGD_Zscz5X_lE6dFFs",
            authDomain: "webnote-9ea1e.firebaseapp.com",
            projectId: "webnote-9ea1e",
            storageBucket: "webnote-9ea1e.firebasestorage.app",
            messagingSenderId: "869875049003",
            appId: "1:869875049003:web:0f7334733cb313e426406e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const googleBtn = document.getElementById('googleBtn');
        const spinner = document.getElementById('spinner');

        googleBtn.onclick = async () => {
            // UI Feedback
            googleBtn.style.opacity = "0.7";
            googleBtn.style.pointerEvents = "none";
            spinner.style.display = "block";

            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;

                // CRUCIAL : On enregistre l'utilisateur dans Firestore
                // C'est ici que l'erreur "Missing Permissions" arrivait si les règles Firestore n'étaient pas prêtes.
                await setDoc(doc(db, "users", user.uid), {
                    username: user.displayName,
                    email: user.email,
                    photo: user.photoURL,
                    lastLogin: serverTimestamp()
                }, { merge: true });

                // On stocke le pseudo localement pour le dashboard
                localStorage.setItem('webnote_username', user.displayName);

                // Redirection
                window.location.href = "dashboard.html";

            } catch (error) {
                console.error("Erreur de connexion:", error);
                alert("Erreur lors de la connexion. Vérifiez vos règles Firestore ou votre connexion.");
                
                // Reset UI
                googleBtn.style.opacity = "1";
                googleBtn.style.pointerEvents = "all";
                spinner.style.display = "none";
            }
        };
    </script>
</body>
</html>

